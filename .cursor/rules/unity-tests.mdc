---
alwaysApply: true
---

# Unity Unit Test Rules (NUnit)

## Scope
Applies to all test code under `Assets/Tests/**` and any assemblies ending with `.Tests`.

## NUnit visibility / Test Assembly
- Every test assembly MUST be an `.asmdef` marked as a Test Assembly by including:
  - `"optionalUnityReferences": ["TestAssemblies"]`
- Test assemblies SHOULD reference only:
  - `Game.Rpc.Contracts`
  - `Game.Rpc.Runtime`
  - (and any other explicitly approved runtime assemblies)

## Assert usage (avoid ambiguity)
- Tests MUST use NUnit assertions only.
- In every test file, add the alias:
  - `using NUnitAssert = NUnit.Framework.Assert;`
- All assertions MUST use `NUnitAssert.*` (e.g., `NUnitAssert.AreEqual(...)`).
- DO NOT use `Assert.*` without qualification.
- DO NOT use `UnityEngine.Assertions.Assert` in tests.

## Unity/IL2CPP compatibility constraints (tests included)
Because the project targets iOS/IL2CPP + HybridCLR:
- DO NOT use `System.Threading.Channels` anywhere in Unity client code, including tests.
- DO NOT use `System.IO.Pipelines` in Unity client code, including tests.
- For `ValueTask`:
  - DO NOT use `ValueTask.CompletedTask` or `ValueTask.FromResult` (may be missing in Unity profile).
  - Use:
    - `return default;` for `ValueTask`
    - `return new ValueTask<T>(value);` for `ValueTask<T>`

## Test types
- Prefer **EditMode** tests for RPC/runtime logic (no scene needed).
- Use **PlayMode** tests only when validating MonoBehaviour, scene lifecycle, or platform integration.

## File template requirement (minimum)
Each new test file MUST start with:
- `using NUnit.Framework;`
- `using NUnitAssert = NUnit.Framework.Assert;`
